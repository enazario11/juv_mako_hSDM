---
title: "Mako hSDM covariate exploration across depth layers"
author: "Emily Nazario"
date: "`r Sys.Date()`"
format:
 html: 
  self-contained: true
editor: visual
toc: TRUE
toc-title: "On this page"
theme: yeti
fontcolor: "#134f5c"
---

```{r}
#| include: false
library(tidyverse)
library(here)
library(terra)
library(MetBrewer)
library(tidyquant)
library(tidyterra)

cmem_dat0 <- readRDS(here("data/locs_w_covar/psat_spot/cmem_locs_covar_AGI_distcoast_0m_back.rds"))
colnames(cmem_dat0) <- c("tag","lon", "lat", "date", "PA", "dt", "o2_mean", "chl_mean", "temp_mean", "sal_mean", "uo_mean", "uostr_mean", "vo_mean", "vostr_mean", "ssh_mean", "mld_mean", "bathy_mean", "bathy_sd", "pO2_atm_0m", "o2_demand_0m", "AGI_0m", "dist_coast")

#in background function PA == 0 is a PA, but I reversed it for the CRW analysis, so I am changing the 0s and 1s here to match the CRW work. 
cmem_dat0$PA <- replace(cmem_dat0$PA, cmem_dat0$PA == 1, 2) #change PAs to temporarily equal 2
cmem_dat0$PA <- replace(cmem_dat0$PA, cmem_dat0$PA == 0, 1) #change true positions to a 1
cmem_dat0$PA <- replace(cmem_dat0$PA, cmem_dat0$PA == 2, 0) #change PA positions to a 0
cmem_dat2 <- cmem_dat0 %>% filter(PA == 0)

cmem_dat60 <- readRDS(here("data/locs_w_covar/psat_spot/cmem_locs_covar_AGI_60m_back.rds"))
colnames(cmem_dat60) <- c("tag", "lon", "lat", "date", "PA", "dt", "o2_mean", "temp_mean", "sal_mean", "pO2_atm_60m", "o2_demand_60m", "AGI_60m")

cmem_dat60$PA <- replace(cmem_dat60$PA, cmem_dat60$PA == 1, 2) #change PAs to temporarily equal 2
cmem_dat60$PA <- replace(cmem_dat60$PA, cmem_dat60$PA == 0, 1) #change true positions to a 1
cmem_dat60$PA <- replace(cmem_dat60$PA, cmem_dat60$PA == 2, 0) #change PA positions to a 0

cmem_dat250 <- readRDS(here("data/locs_w_covar/psat_spot/cmem_locs_covar_AGI_250m_back.rds"))
colnames(cmem_dat250) <- c("tag", "lon", "lat", "date", "PA", "dt", "o2_mean", "temp_mean", "sal_mean", "pO2_atm_250m", "o2_demand_250m", "AGI_250m")

cmem_dat250$PA <- replace(cmem_dat250$PA, cmem_dat250$PA == 1, 2) #change PAs to temporarily equal 2
cmem_dat250$PA <- replace(cmem_dat250$PA, cmem_dat250$PA == 0, 1) #change true positions to a 1
cmem_dat250$PA <- replace(cmem_dat250$PA, cmem_dat250$PA == 2, 0) #change PA positions to a 0

theme_set(theme_tq() +
  theme(strip.text = element_text(size = 16), 
        axis.text = element_text(size = 14, color = "black"), 
        axis.title = element_text(size = 16), 
        legend.text = element_text(size = 16)))

```

For each of the figures below, I have visualized what the covariate values are for the CRW pseudo absence positions and observed positions across three depth layers (0m, 60m, and 250m). I have also explored the covariate values using the full range of the available positions using environmental data from Copernicus Marine and Environment Monitoring Service (CMEMS).

Lastly, for each collection of a shark's observed positions, there are 22 replicate pseudo absence CRW tracks for the CMEM domain. This will eventually be sampled down to PA replicate for each observed track to maintain a 1:1 ration between observed and pseudo absence locations.

# Covariate summary plots for all sharks

## Covariate selection justification

```{r}
#| echo: false
#| warning: false
#| message: false
covar_just <- read.csv(here("data/enviro/CMEMS/covar-just.csv"))
kableExtra::kable(covar_just)
```

## Map of obsv. positions

Each color represents a different shark track. The tracks are made up of the interpolated state space model positions generated by with the aniMotum package using a time step of 29 hours (the mean time step between positions from the raw data).

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 8
#| fig-height: 7

#define map for figure
poly = sf::st_read(here("data/PAs/background/psat_spot_domain/mako.shp"))

ggplot()+
  geom_polygon(data = fortify(maps::map("world", plot = F, fill = T)), aes(x = long, y = lat, group = group), color = "grey20", fill = "grey60")+ #fortify converts spatial objects to data frames for ggplot
  geom_point(data = cmem_dat0, aes(x = lon, y = lat, color = as.factor(PA), group = PA), size = 0.7, alpha = 0.8)+
  geom_sf(data = poly, fill = NA, color = "black") + 
  scale_color_manual("PA", values = c("0" = "goldenrod2", "1" = "dodgerblue4")) + 
  coord_sf(xlim = c(-155, -103), ylim = c(1, 49)) +
  theme_tq()

```

## Broad covariate comparisons at 0m

::: panel-tabset
### Density

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 12
#| fig-height: 12

cmem_0m_long <- gather(cmem_dat0, covar, value, o2_mean:dist_coast) %>% mutate(PA = as.factor(PA))

ggplot(cmem_0m_long, aes(x = value, fill = PA)) + 
  geom_density(alpha = 0.35) + 
  facet_wrap(~covar, scales = "free") + 
  scale_fill_manual(values = c("#ABC9C8", "#0E3F61"))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Boxplots

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 12
#| fig-height: 12

ggplot(cmem_0m_long, aes(x = PA, y = value, fill = PA)) + 
  geom_boxplot() + 
  facet_wrap(~covar, scales = "free")+ 
  scale_fill_manual(values = c("#ABC9C8", "#0E3F61"))

```

### Time vs. covar scatter

The figures below only represent covariate values for observed positions. PA positions were omitted from this analysis due to the quantity.

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 12
#| fig-height: 10

cmem_0m_long %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = dt, y = value, color = covar)) + 
  geom_point(alpha = 0.2) +
  geom_smooth(color = "grey20", se = FALSE)+
  facet_wrap(~covar, scales = "free") + 
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_color_manual(values = met.brewer("Hokusai2", 16))+
  xlab("")
```
:::

## Broad covariate comparisons at 60m

::: panel-tabset
### Density

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 12
#| fig-height: 12

cmem_60m_long <- gather(cmem_dat60, covar, value, o2_mean:AGI_60m) %>% mutate(PA = as.factor(PA))

ggplot(cmem_60m_long, aes(x = value, fill = PA)) + 
  geom_density(alpha = 0.35) + 
  facet_wrap(~covar, scales = "free") + 
  scale_fill_manual(values = c("#ABC9C8", "#0E3F61"))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Boxplots

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 12
#| fig-height: 12

ggplot(cmem_60m_long, aes(x = PA, y = value, fill = PA)) + 
  geom_boxplot() + 
  facet_wrap(~covar, scales = "free")+ 
  scale_fill_manual(values = c("#ABC9C8", "#0E3F61"))
```

### Time vs. covar scatter

The figures below only represent covariate values for observed positions. PA positions were omitted from this analysis due to the quantity.

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 12
#| fig-height: 10

cmem_60m_long %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = dt, y = value, color = covar)) + 
  geom_point(alpha = 0.2) +
  geom_smooth(color = "grey20", se = FALSE)+
  facet_wrap(~covar, scales = "free") + 
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_color_manual(values = met.brewer("Hokusai2", 16))+
  xlab("")
```
:::

## Broad covariate comparisons at 250m

::: panel-tabset
### Density

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 12
#| fig-height: 12

cmem_250m_long <- gather(cmem_dat250, covar, value, o2_mean:AGI_250m) %>% mutate(PA = as.factor(PA))

ggplot(cmem_250m_long, aes(x = value, fill = PA)) + 
  geom_density(alpha = 0.35) + 
  facet_wrap(~covar, scales = "free") + 
  scale_fill_manual(values = c("#ABC9C8", "#0E3F61"))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Boxplots

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 12
#| fig-height: 12

ggplot(cmem_250m_long, aes(x = PA, y = value, fill = PA)) + 
  geom_boxplot() + 
  facet_wrap(~covar, scales = "free")+ 
  scale_fill_manual(values = c("#ABC9C8", "#0E3F61"))
```

### Time vs. covar scatter

The figures below only represent covariate values for observed positions. PA positions were omitted from this analysis due to the quantity.

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 12
#| fig-height: 10

cmem_250m_long %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = dt, y = value, color = covar)) + 
  geom_point(alpha = 0.2) +
  geom_smooth(color = "grey20", se = FALSE)+
  facet_wrap(~covar, scales = "free") + 
  theme(legend.position = "none", 
        axis.text.x = element_text(angle = 45, hjust = 1))+
  scale_color_manual(values = met.brewer("Hokusai2", 16))+
  xlab("")
```
:::

## Abiotic covariate comparisons at 0m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### Temp vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = pO2_atm_0m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### DO (mmol/m\^3) vs. MLD

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = o2_mean, y = mld_mean, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. MLD

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = mld_mean, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```
:::

## Abiotic covariate comparisons at 60m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### Temp vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = pO2_atm_60m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. DO (mmol/m\^3)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = o2_mean, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```
:::

## Abiotic covariate comparisons at 250m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### Temp vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = pO2_atm_250m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. DO (mmol/m\^3)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = o2_mean, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```
:::

## Metabolic demand covariate comparisons at 0m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### Temp vs O2 demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = o2_demand_0m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. DO (atm) vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = pO2_atm_0m, fill = o2_demand_0m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lat vs. temp vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, fill = o2_demand_0m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lat vs. DO (atm) vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = pO2_atm_0m, fill = o2_demand_0m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lon vs. temp vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = temp_mean, fill = o2_demand_0m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lon vs. DO (atm) vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = pO2_atm_0m, fill = o2_demand_0m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```
:::

## Metabolic demand covariate comparisons at 60m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### Temp vs O2 demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = o2_demand_60m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. DO (atm) vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = pO2_atm_60m, fill = o2_demand_60m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lat vs. temp vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, fill = o2_demand_60m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lat vs. DO (atm) vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = pO2_atm_60m, fill = o2_demand_60m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lon vs. temp vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = temp_mean, fill = o2_demand_60m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lon vs. DO (atm) vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = pO2_atm_60m, fill = o2_demand_60m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```
:::

## Metabolic demand covariate comparisons at 250m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### Temp vs O2 demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = o2_demand_250m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. DO (atm) vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = pO2_atm_250m, fill = o2_demand_250m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lat vs. temp vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, fill = o2_demand_250m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lat vs. DO (atm) vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = pO2_atm_250m, fill = o2_demand_250m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lon vs. temp vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = temp_mean, fill = o2_demand_250m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```

### Lon vs. DO (atm) vs. demand

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = pO2_atm_250m, fill = o2_demand_250m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```
:::

## AGI covar comparisons at 0m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### DO (atm) vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = pO2_atm_0m, y = AGI_0m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### DO (mmol/m\^3) vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = o2_mean, y = AGI_0m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = AGI_0m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Bathy vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = bathy_mean, y = AGI_0m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. DO (atm) vs. AGI surface plot

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center
source(here("functions/oxy_demand_functions.R"))

o2_range <- seq(176.7334, 328.9446, length.out = 100)
temp_range <- seq(4.945004, 32.50116, length.out = 100)

AGI_surf0 <- expand_grid(o2 = o2_range, temp = temp_range) %>% 
  mutate(po2 = rast_to_atm(do = o2, so = 33.71317, temp = temp, depth = 0),
         met_dem = OxyDemand(Tpref = 16.452, PO2_thresh = 0.0488, T_C = temp), 
         AGI = po2/met_dem)

ggplot(AGI_surf0, aes(temp, o2)) +
  geom_raster(aes(fill = AGI)) +
  stat_contour(aes(z = AGI), color = "black") +
  scale_fill_gradient() + 
  xlab("Temperature (C)") + 
  ylab(bquote('Dissolved oxygen' ('mmol/m'^'3'))) +
  labs(fill = "AGI") +
  scale_fill_whitebox_c(palette = "deep", direction = -1)
```

### Temp vs. DO (atm) vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = pO2_atm_0m, fill = AGI_0m)) + 
  geom_point(size = 3, shape = 21)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```
:::

## AGI covar comparisons at 60m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### DO (atm) vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = pO2_atm_60m, y = AGI_60m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### DO (mmol/m\^3) vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = o2_mean, y = AGI_60m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = AGI_60m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. DO (atm) vs. AGI surface plot

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center


o2_range <- seq(6.581265, 321.6142, length.out = 100)
temp_range <- seq(5.069174, 29.21631, length.out = 100)

AGI_surf60 <- expand_grid(o2 = o2_range, temp = temp_range) %>% 
  mutate(po2 = rast_to_atm(do = o2, so = 33.81795, temp = temp, depth = 60),
         met_dem = OxyDemand(Tpref = 16.452, PO2_thresh = 0.046413, T_C = temp), 
         AGI = po2/met_dem)

ggplot(AGI_surf60, aes(temp, o2)) +
  geom_raster(aes(fill = AGI)) +
  stat_contour(aes(z = AGI), color = "black") +
  scale_fill_gradient() + 
  xlab("Temperature (C)") + 
  ylab(bquote('Dissolved oxygen' ('mmol/m'^'3'))) +
  labs(fill = "AGI") +
  scale_fill_whitebox_c(palette = "deep", direction = -1)
  
```

### Temp vs. DO (atm) vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = pO2_atm_60m, fill = AGI_60m)) + 
  geom_point(size = 3, shape = 21)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```
:::

## AGI covar comparisons at 250m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### DO (atm) vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = pO2_atm_250m, y = AGI_250m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### DO (mmol/m\^3) vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = o2_mean, y = AGI_250m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = AGI_250m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Temp vs. DO (atm) vs. AGI surface plot

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center
source(here("functions/oxy_demand_functions.R"))

o2_range <- seq(1.000011, 240.0723, length.out = 100)
temp_range <- seq(4.688958, 17.49262, length.out = 100)

AGI_surf250 <- expand_grid(o2 = o2_range, temp = temp_range) %>% 
  mutate(po2 = rast_to_atm(do = o2, so = 34.28668, temp = temp, depth = 60),
         met_dem = OxyDemand(Tpref = 16.452, PO2_thresh = 0.03815, T_C = temp), 
         AGI = po2/met_dem)

ggplot(AGI_surf250, aes(temp, o2)) +
  geom_raster(aes(fill = AGI)) +
  stat_contour(aes(z = AGI), color = "black") +
  scale_fill_gradient() + 
  xlab("Temperature (C)") + 
  ylab(bquote('Dissolved oxygen' ('mmol/m'^'3'))) +
  labs(fill = "AGI") +
  scale_fill_whitebox_c(palette = "deep", direction = -1)
  
```

### Temp vs. DO (atm) vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = temp_mean, y = pO2_atm_250m, fill = AGI_250m)) + 
  geom_point(size = 3, shape = 21)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()

```
:::

## Lat/lon covar comparisons at 0m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### Lat vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = AGI_0m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lat vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = pO2_atm_0m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lon vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = AGI_0m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lon vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = pO2_atm_0m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lat vs. Bathy

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = bathy_mean, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lon vs. Bathy

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = bathy_mean, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lat vs. Temp

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lat vs. Temp vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, fill = AGI_0m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```

### Lon vs. Temp vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = temp_mean, fill = AGI_0m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```

### Lon vs. Temp vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = temp_mean, fill = pO2_atm_0m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```

### Lat vs. Temp vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, fill = pO2_atm_0m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```

### Lat vs. MLD

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat0 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = mld_mean, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```
:::

## Lat/lon covar comparisons at 60m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### Lat vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = AGI_60m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lat vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = pO2_atm_60m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lon vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = AGI_60m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lon vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = pO2_atm_60m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lat vs. Temp

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lat vs. Temp vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, fill = AGI_60m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```

### Lon vs. Temp vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = temp_mean, fill = AGI_60m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```

### Lon vs. Temp vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = temp_mean, fill = pO2_atm_60m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```

### Lat vs. Temp vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat60 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, fill = pO2_atm_60m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```
:::

## Lat/lon covar comparisons at 250m

Below are some comparisons of the covariate values relative to each other for the observed positions (covariate values at PA positions are excluded).

::: panel-tabset
### Lat vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = AGI_250m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lat vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = pO2_atm_250m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lon vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = AGI_250m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lon vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = pO2_atm_250m, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lat vs. Temp

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 4
#| fig-height: 4
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, color = as.factor(PA))) + 
  geom_point(alpha = 0.2) +
  scale_color_manual(values = c("#0a3351"))+
  theme(legend.position = "none")
```

### Lat vs. Temp vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, fill = AGI_250m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```

### Lon vs. Temp vs. AGI

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = temp_mean, fill = AGI_250m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```

### Lon vs. Temp vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lon, y = temp_mean, fill = pO2_atm_250m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```

### Lat vs. Temp vs. DO (atm)

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-width: 6
#| fig-height: 6
#| fig-align: center

cmem_dat250 %>% 
  filter(PA == 0) %>%
  ggplot(aes(x = lat, y = temp_mean, fill = pO2_atm_250m)) + 
  geom_point(shape = 21, size = 3)+
  theme(legend.position = "right")+
  scale_fill_viridis_c()
```
:::

